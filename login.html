<html>
	<head>
		<script>
		localStorage.setItem("client_id", "");
		localStorage.setItem("client_secret", "");
		let params = 'scrollbars=no,resizable=no,status=no,location=yes,toolbar=no,menubar=no,width=23,height=80,left=0,top=0';

</script>
	</head>
	<body>
		
			<a id="login" class="connect" style="display: none;" href="https://discordapp.com/api/oauth2/authorize?client_id=551194918853410817&redirect_uri=https%3A%2F%2Fdexterateed.github.io%2Fdemonitized.github.io%2Flogin.html&response_type=code&scope=identify%20email%20guilds">Connect to Discord</a>
	<script>
		window.onload = () => {
			const fragment = new URLSearchParams(window.location.hash.slice(1));

			if (fragment.has("access_token")) {
				const accessToken = fragment.get("access_token");
				const tokenType = fragment.get("token_type");

				fetch('https://discordapp.com/api/users/@me', {
					headers: {
						authorization: `${tokenType} ${accessToken}`
					}
				})
					.then(res => res.json())
					.then(response => {
						const { username, discriminator } = response;
						document.getElementById('info').innerText += ` ${username}#${discriminator}`;
					})
					.catch(console.error);

			}
			else {
				document.getElementById('login').style.display = 'block';
			}
		}
		
		function generateRandomString() {
	const rand = Math.floor(Math.random() * 10);
	let randStr = '';

	for (let i = 0; i < 20 + rand; i++) {
		randStr += String.fromCharCode(33 + Math.floor(Math.random() * 94));
	}

	return randStr;
}

// ...

// generate and store the string
const randStr = generateRandomString();
localStorage.setItem('stateParameter', randStr);

document.getElementById('login').href += `&state=${btoa(randStr)}`;
		
		const fragment = new URLSearchParams(window.location.hash.slice(1));

if (fragment.has('access_token')) {
	const urlState = fragment.get('state');
	const stateParameter = localStorage.getItem('stateParameter');
	if (stateParameter !== atob(decodeURIComponent(urlState))) {
		return console.log('You may have been clickjacked!');
	}
}
		
		const url = require('url');

// ...

const urlObj = url.parse(req.url, true);

if (urlObj.query.code) {
	const accessCode = urlObj.query.code;
	console.log(`The access code is: ${accessCode}`);
}

if (urlObj.pathname === '/') {
	responseCode = 200;
	content = fs.readFileSync('./index.html');
}
		
		const fetch = require('node-fetch');
const FormData = require('form-data');

// ...

const data = new FormData();

data.append('client_id', 'your client id');
data.append('client_secret', 'your client secret');
data.append('grant_type', 'authorization_code');
data.append('redirect_uri', 'your redirect url');
data.append('scope', 'the scopes');
data.append('code', accessCode);

fetch('https://discordapp.com/api/oauth2/token', {
	method: 'POST',
	body: data,
})
	.then(res => res.json())
	.then(console.log);
		
		fetch('https://discordapp.com/api/oauth2/token', {
	method: 'POST',
	body: data,
})
	.then(res => res.json())
	.then(info => fetch('https://discordapp.com/api/users/@me', {
		headers: {
			authorization: `${info.token_type} ${info.access_token}`,
		},
	}))
	.then(console.log);
	</script>
		<div id="info">
		Welcome!
	</div>
	<style>
	.connect {
	background:    #3d85c6;
background:    linear-gradient(#3d85c6, #073763);
border:        3px solid #556699;
border-radius: 5px;
padding:       8px 20px;
color:         #ffffff;
display:       inline-block;
font:          normal bold 26px/1 "Ubuntu", sans-serif;
text-align:    center;
text-shadow:   3px 3px #000000;
	}
	</style>
	</body>
</html>
